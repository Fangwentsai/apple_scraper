# ğŸ·ï¸ Apple æ•´ä¿®å“åƒ¹æ ¼è¿½è¹¤ç³»çµ±ä½¿ç”¨æŒ‡å—

## ğŸ“‹ ç³»çµ±æ¦‚è¿°

Apple æ•´ä¿®å“åƒ¹æ ¼è¿½è¹¤ç³»çµ±æ˜¯ä¸€å€‹å®Œæ•´çš„åƒ¹æ ¼ç›£æ§è§£æ±ºæ–¹æ¡ˆï¼Œèƒ½å¤ ï¼š

- ğŸ“Š **æ¯æ—¥åƒ¹æ ¼è¨˜éŒ„**ï¼šè‡ªå‹•è¨˜éŒ„æ¯ä»¶å•†å“æ¯å¤©çš„åƒ¹æ ¼è®ŠåŒ–
- ğŸ”” **æ™ºèƒ½é€šçŸ¥ç³»çµ±**ï¼šé™åƒ¹æ™‚è‡ªå‹•é€šçŸ¥ç›¸é—œç”¨æˆ¶
- ğŸ“ˆ **åƒ¹æ ¼è¶¨å‹¢åˆ†æ**ï¼šæä¾›è©³ç´°çš„åƒ¹æ ¼åˆ†æå’Œå¸‚å ´å ±å‘Š
- â˜ï¸ **é›²ç«¯å‚™ä»½**ï¼šæ‰€æœ‰è³‡æ–™è‡ªå‹•å‚™ä»½åˆ° Firebase
- ğŸ¤– **è‡ªå‹•åŒ–æ’ç¨‹**ï¼šç„¡éœ€äººå·¥å¹²é çš„å…¨è‡ªå‹•é‹è¡Œ

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. å»ºç«‹ç¯„ä¾‹è³‡æ–™ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰

```bash
# å»ºç«‹30å¤©çš„ç¯„ä¾‹åƒ¹æ ¼æ­·å²è³‡æ–™
python create_sample_price_data.py
```

é€™æœƒå»ºç«‹ï¼š
- éå»30å¤©çš„åƒ¹æ ¼æ­·å²è³‡æ–™
- åŒ…å«åƒ¹æ ¼è®ŠåŒ–çš„ç¯„ä¾‹è³‡æ–™
- ç”¨æ–¼æ¸¬è©¦åˆ†æåŠŸèƒ½çš„å®Œæ•´è³‡æ–™é›†

### 2. åŸ·è¡Œåƒ¹æ ¼è¿½è¹¤

```bash
# æ‰‹å‹•åŸ·è¡Œä¸€æ¬¡åƒ¹æ ¼è¿½è¹¤
python price_tracker.py
```

é¸æ“‡åŠŸèƒ½ï¼š
1. **åŸ·è¡Œä»Šæ—¥åƒ¹æ ¼è¿½è¹¤** - çˆ¬å–æœ€æ–°åƒ¹æ ¼ä¸¦æ¯”è¼ƒè®ŠåŒ–
2. **æŸ¥çœ‹ç”¢å“åƒ¹æ ¼æ­·å²** - æŸ¥è©¢ç‰¹å®šç”¢å“çš„åƒ¹æ ¼è®ŠåŒ–
3. **ç”Ÿæˆåƒ¹æ ¼è®ŠåŒ–å ±å‘Š** - ç”¢ç”Ÿè©³ç´°çš„åƒ¹æ ¼åˆ†æå ±å‘Š
4. **æŸ¥çœ‹åƒ¹æ ¼è®ŠåŒ–æ‘˜è¦** - å¿«é€Ÿç€è¦½åƒ¹æ ¼è®ŠåŒ–çµ±è¨ˆ

### 3. å•Ÿå‹•è‡ªå‹•æ’ç¨‹

```bash
# å•Ÿå‹•æ¯æ—¥åƒ¹æ ¼è¿½è¹¤æ’ç¨‹å™¨
python daily_price_scheduler.py
```

è‡ªå‹•æ’ç¨‹æ™‚é–“ï¼š
- **æ¯å¤© 09:00** - åŸ·è¡Œåƒ¹æ ¼è¿½è¹¤
- **æ¯å¤© 21:00** - åŸ·è¡Œåƒ¹æ ¼è¿½è¹¤  
- **æ¯å¤© 22:00** - ç”Ÿæˆæ¯æ—¥å ±å‘Š

## ğŸ“Š åƒ¹æ ¼åˆ†æå·¥å…·

### å•Ÿå‹•åˆ†æå·¥å…·

```bash
python price_analyzer.py
```

### åˆ†æåŠŸèƒ½

#### 1. åƒ¹æ ¼è¶¨å‹¢åˆ†æ
- åˆ†ææ¯å€‹ç”¢å“çš„åƒ¹æ ¼è®ŠåŒ–è¶¨å‹¢
- è¨ˆç®—åƒ¹æ ¼æ³¢å‹•æ€§å’Œè®ŠåŒ–ç™¾åˆ†æ¯”
- åˆ¤æ–·è¶¨å‹¢æ–¹å‘ï¼ˆä¸Šæ¼²/ä¸‹è·Œ/ç©©å®šï¼‰

#### 2. é¡åˆ¥åƒ¹æ ¼çµ±è¨ˆ
- å„ç”¢å“é¡åˆ¥çš„åƒ¹æ ¼åˆ†å¸ƒ
- æœ€é«˜åƒ¹ã€æœ€ä½åƒ¹ã€å¹³å‡åƒ¹ã€ä¸­ä½æ•¸
- åƒ¹æ ¼ç¯„åœå’Œæ¨™æº–å·®

#### 3. æœ€ä½³å„ªæƒ æŸ¥è©¢
- æ‰¾å‡ºé™åƒ¹æœ€å¤šçš„ç”¢å“
- æŒ‰é™åƒ¹é‡‘é¡æˆ–ç™¾åˆ†æ¯”æ’åº
- æä¾›è³¼è²·å»ºè­°

#### 4. å¸‚å ´å ±å‘Šç”Ÿæˆ
- å®Œæ•´çš„å¸‚å ´åˆ†æå ±å‘Š
- åŒ…å«è¶¨å‹¢åˆ†æã€çµ±è¨ˆè³‡æ–™ã€æœ€ä½³å„ªæƒ 
- é©åˆå®šæœŸæª¢è¦–å¸‚å ´ç‹€æ³

## ğŸ”” é€šçŸ¥ç³»çµ±è¨­å®š

### Firebase è¨­å®š

1. **å»ºç«‹ Firebase å°ˆæ¡ˆ**
   - å‰å¾€ [Firebase Console](https://console.firebase.google.com/)
   - å»ºç«‹æ–°å°ˆæ¡ˆ
   - å•Ÿç”¨ Firestore Database

2. **ä¸‹è¼‰æœå‹™å¸³æˆ¶é‡‘é‘°**
   - å°ˆæ¡ˆè¨­å®š â†’ æœå‹™å¸³æˆ¶
   - ç”¢ç”Ÿæ–°çš„ç§å¯†é‡‘é‘°
   - å°‡æª”æ¡ˆå‘½åç‚º `firebase-service-account.json`

3. **è¨­å®š Firestore è¦å‰‡**
   ```javascript
   rules_version = '2';
   service cloud.firestore {
     match /databases/{database}/documents {
       match /{document=**} {
         allow read, write: if true;
       }
     }
   }
   ```

### Line Bot é€šçŸ¥è¨­å®š

1. **è¨­å®š Line Bot**
   - åƒè€ƒä¸»è¦ README.md çš„ Line Bot è¨­å®šç« ç¯€
   - ç¢ºä¿ Webhook æ­£å¸¸é‹ä½œ

2. **ç”¨æˆ¶é€šçŸ¥è«‹æ±‚**
   - ç”¨æˆ¶é€é Line Bot è¨­å®šé—œæ³¨çš„ç”¢å“é¡åˆ¥å’Œåƒ¹æ ¼ç¯„åœ
   - ç³»çµ±æœƒåœ¨ Firebase ä¸­è¨˜éŒ„ç”¨æˆ¶è«‹æ±‚
   - ç•¶æœ‰ç¬¦åˆæ¢ä»¶çš„é™åƒ¹æ™‚è‡ªå‹•ç™¼é€é€šçŸ¥

## ğŸ“ è³‡æ–™çµæ§‹

### åƒ¹æ ¼æ­·å²æª”æ¡ˆæ ¼å¼

```json
{
  "date": "2024-01-15",
  "timestamp": "2024-01-15T09:00:00",
  "categories": {
    "mac": {
      "product_count": 84,
      "products": [
        {
          "product_id": "mac_1234",
          "title": "MacBook Air M2 8GB 256GB - å¤ªç©ºç°è‰² (æ•´ä¿®å“)",
          "price": 25900,
          "price_str": "NT$25,900",
          "url": "https://...",
          "category": "mac"
        }
      ]
    }
  },
  "total_products": 100,
  "price_changes": [
    {
      "product_id": "mac_1234",
      "title": "MacBook Air M2 8GB 256GB - å¤ªç©ºç°è‰² (æ•´ä¿®å“)",
      "category": "mac",
      "old_price": 26900,
      "new_price": 25900,
      "change_amount": -1000,
      "change_percentage": -3.72
    }
  ],
  "new_products": [],
  "discontinued_products": []
}
```

### Firebase è³‡æ–™çµæ§‹

#### 1. price_tracking Collection
- æ–‡ä»¶IDï¼šæ—¥æœŸ (YYYY-MM-DD)
- å…§å®¹ï¼šå®Œæ•´çš„æ¯æ—¥åƒ¹æ ¼è¿½è¹¤è³‡æ–™

#### 2. price_changes Collection
- è‡ªå‹•ç”Ÿæˆæ–‡ä»¶ID
- å…§å®¹ï¼šå€‹åˆ¥åƒ¹æ ¼è®ŠåŒ–è¨˜éŒ„

#### 3. requests Collectionï¼ˆå¢å¼·ç‰ˆï¼‰
- æ–‡ä»¶IDï¼šè‡ªå‹•ç”Ÿæˆ
- å…§å®¹ï¼šç”¨æˆ¶é€šçŸ¥è«‹æ±‚
```json
{
  "userid": "Lineç”¨æˆ¶ID",
  "product": "ç”¢å“é¡åˆ¥",
  "price": æœ€é«˜åƒ¹æ ¼,
  "category": "ç”¢å“é¡åˆ¥",
  "notice": false,
  "created_at": "å»ºç«‹æ™‚é–“",
  "updated_at": "æ›´æ–°æ™‚é–“",
  "last_query_date": "æœ€å¾ŒæŸ¥è©¢æ—¥æœŸ",
  "notification_count": 0,
  "active": true
}
```

#### 4. price_volatility_events Collectionï¼ˆæ–°å¢ï¼‰
- æ–‡ä»¶IDï¼šè‡ªå‹•ç”Ÿæˆ
- å…§å®¹ï¼šåƒ¹æ ¼æ³¢å‹•äº‹ä»¶è¨˜éŒ„
```json
{
  "category": "ç”¢å“é¡åˆ¥",
  "product_title": "ç”¢å“æ¨™é¡Œ",
  "old_price": èˆŠåƒ¹æ ¼,
  "new_price": æ–°åƒ¹æ ¼,
  "change_amount": è®ŠåŒ–é‡‘é¡,
  "change_percentage": è®ŠåŒ–ç™¾åˆ†æ¯”,
  "event_type": "price_drop/price_increase",
  "severity": "high/medium",
  "timestamp": "äº‹ä»¶æ™‚é–“",
  "date": "äº‹ä»¶æ—¥æœŸ",
  "notified_users": é€šçŸ¥ç”¨æˆ¶æ•¸é‡
}
```

#### 5. notification_history Collectionï¼ˆæ–°å¢ï¼‰
- æ–‡ä»¶IDï¼šè‡ªå‹•ç”Ÿæˆ
- å…§å®¹ï¼šé€šçŸ¥æ­·å²è¨˜éŒ„
```json
{
  "userid": "Lineç”¨æˆ¶ID",
  "notification_type": "price_drop/price_volatility/new_product",
  "category": "ç”¢å“é¡åˆ¥",
  "content": "é€šçŸ¥å…§å®¹",
  "timestamp": "é€šçŸ¥æ™‚é–“",
  "date": "é€šçŸ¥æ—¥æœŸ"
}
```

#### 4. system_logs Collection
- æ–‡ä»¶IDï¼šè‡ªå‹•ç”Ÿæˆ
- å…§å®¹ï¼šç³»çµ±åŸ·è¡Œæ—¥èªŒ

## âš¡ åƒ¹æ ¼æ³¢å‹•é€šçŸ¥åŠŸèƒ½

### åŠŸèƒ½ç‰¹è‰²

1. **è‡ªå‹•åµæ¸¬é«˜æ³¢å‹•æ€§ç”¢å“**
   - åµæ¸¬åƒ¹æ ¼è®ŠåŒ–è¶…é 10% çš„ç”¢å“
   - æ”¯æ´é™åƒ¹å’Œæ¼²åƒ¹é›™å‘åµæ¸¬
   - è‡ªå‹•è¨˜éŒ„æ³¢å‹•äº‹ä»¶åˆ° Firebase

2. **æ™ºèƒ½ç”¨æˆ¶é€šçŸ¥**
   - é€šçŸ¥æœ€è¿‘ 3 å¤©å…§æŸ¥è©¢éè©²é¡åˆ¥çš„ç”¨æˆ¶
   - é¿å…é‡è¤‡é€šçŸ¥ï¼Œæå‡ç”¨æˆ¶é«”é©—
   - è¨˜éŒ„é€šçŸ¥æ­·å²å’Œçµ±è¨ˆ

3. **é¡åˆ¥è¿½è¹¤ç³»çµ±**
   - è¨˜éŒ„ç”¨æˆ¶æŸ¥è©¢çš„ç”¢å“é¡åˆ¥
   - ç²¾æº–åŒ¹é…ç”¨æˆ¶èˆˆè¶£
   - æ”¯æ´å¤šé¡åˆ¥åŒæ™‚è¿½è¹¤

### ä½¿ç”¨æ–¹å¼

#### 1. æ¸¬è©¦åƒ¹æ ¼æ³¢å‹•é€šçŸ¥
```bash
# åŸ·è¡Œæ¸¬è©¦è…³æœ¬
python test_volatility_notifications.py
```

#### 2. æ‰‹å‹•è§¸ç™¼æ³¢å‹•æª¢æŸ¥
```python
from daily_price_scheduler import DailyPriceScheduler

scheduler = DailyPriceScheduler()
# é€™æœƒè‡ªå‹•æª¢æŸ¥ä¸¦ç™¼é€æ³¢å‹•é€šçŸ¥
scheduler.run_daily_tracking()
```

#### 3. æŸ¥è©¢æ³¢å‹•äº‹ä»¶
```python
from firebase_enhanced_requests import EnhancedFirebaseRequests

firebase_requests = EnhancedFirebaseRequests()

# æŸ¥è©¢é«˜æ³¢å‹•æ€§ç”¢å“
volatile_products = firebase_requests.get_high_volatility_products(days=7)

# æŸ¥è©¢æœ€è¿‘æŸ¥è©¢éæŸé¡åˆ¥çš„ç”¨æˆ¶
recent_users = firebase_requests.get_recent_category_users('mac', days=3)
```

### é€šçŸ¥è¨Šæ¯ç¯„ä¾‹

ç•¶åµæ¸¬åˆ°åƒ¹æ ¼æ³¢å‹•æ™‚ï¼Œç³»çµ±æœƒç™¼é€é¡ä¼¼ä»¥ä¸‹çš„é€šçŸ¥ï¼š

```
âš¡ MAC ç”¢å“åƒ¹æ ¼å¤§å¹…æ³¢å‹•è­¦å ±ï¼

ğŸ“Š ç™¼ç¾ 3 å€‹ç”¢å“åƒ¹æ ¼è®ŠåŒ–è¶…é 10%

ğŸ“‰ å¤§å¹…é™åƒ¹ (2 å€‹):
â€¢ MacBook Air M2 8GB 256GB - å¤ªç©ºç°è‰²...
  é™åƒ¹ 20.0% (çœ NT$7,000)
  ç¾åƒ¹ NT$28,000

â€¢ iMac 24å‹ M1 8GB 256GB - è—è‰²...
  é™åƒ¹ 15.6% (çœ NT$7,000)
  ç¾åƒ¹ NT$38,000

ğŸ“ˆ å¤§å¹…æ¼²åƒ¹ (1 å€‹):
â€¢ MacBook Pro 13å‹ M2 8GB 256GB...
  æ¼²åƒ¹ 12.5%
  ç¾åƒ¹ NT$45,000

ğŸ’¡ é€™æ˜¯å› ç‚ºæ‚¨æœ€è¿‘3å¤©å…§æŸ¥è©¢éæ­¤é¡åˆ¥ç”¢å“
ğŸ›’ å¦‚æœ‰èˆˆè¶£è«‹æŠŠæ¡æ©Ÿæœƒï¼
```

## ğŸ› ï¸ é€²éšè¨­å®š

### è‡ªè¨‚åƒ¹æ ¼è¿½è¹¤é »ç‡

ç·¨è¼¯ `daily_price_scheduler.py`ï¼š

```python
# ä¿®æ”¹æ’ç¨‹æ™‚é–“
schedule.every().day.at("09:00").do(self.daily_price_tracking)  # æ—©ä¸Š9é»
schedule.every().day.at("21:00").do(self.daily_price_tracking)  # æ™šä¸Š9é»

# æˆ–è¨­å®šæ›´é »ç¹çš„è¿½è¹¤
schedule.every(4).hours.do(self.daily_price_tracking)  # æ¯4å°æ™‚
```

### è‡ªè¨‚é€šçŸ¥æ¢ä»¶

ç·¨è¼¯ `daily_price_scheduler.py` ä¸­çš„é€šçŸ¥é‚è¼¯ï¼š

```python
# ä¿®æ”¹é™åƒ¹é€šçŸ¥æ¢ä»¶
if (drop['category'] == requested_product and 
    drop['new_price'] <= max_price and
    abs(drop['change_percentage']) >= 5):  # é™åƒ¹è¶…é5%æ‰é€šçŸ¥
```

### è‡ªè¨‚åˆ†æåƒæ•¸

ç·¨è¼¯ `price_analyzer.py` ä¸­çš„åˆ†æåƒæ•¸ï¼š

```python
# ä¿®æ”¹è¶¨å‹¢åˆ¤æ–·æ¨™æº–
if total_change_percent > 3:      # æ¼²åƒ¹è¶…é3%
    trend_direction = "ä¸Šæ¼²"
elif total_change_percent < -3:   # é™åƒ¹è¶…é3%
    trend_direction = "ä¸‹è·Œ"
else:
    trend_direction = "ç©©å®š"
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. æ²’æœ‰åƒ¹æ ¼æ­·å²è³‡æ–™
```bash
# å»ºç«‹ç¯„ä¾‹è³‡æ–™
python create_sample_price_data.py
```

#### 2. Firebase é€£æ¥å¤±æ•—
- æª¢æŸ¥ `firebase-service-account.json` æª”æ¡ˆæ˜¯å¦å­˜åœ¨
- ç¢ºèª Firebase å°ˆæ¡ˆè¨­å®šæ­£ç¢º
- æª¢æŸ¥ç¶²è·¯é€£æ¥

#### 3. Line Bot é€šçŸ¥å¤±æ•—
- ç¢ºèª Line Bot Token è¨­å®šæ­£ç¢º
- æª¢æŸ¥ Webhook URL æ˜¯å¦å¯è¨ªå•
- ç¢ºèªç”¨æˆ¶å·²åŠ å…¥ Line Bot å¥½å‹

#### 4. åƒ¹æ ¼è¿½è¹¤ç„¡è³‡æ–™
- ç¢ºèªçˆ¬èŸ²ç¨‹å¼æ­£å¸¸é‹ä½œ
- æª¢æŸ¥ç¶²è·¯é€£æ¥å’Œ Apple å®˜ç¶²å¯è¨ªå•æ€§
- æŸ¥çœ‹ç³»çµ±æ—¥èªŒäº†è§£éŒ¯èª¤åŸå› 

### æ—¥èªŒæª¢æŸ¥

ç³»çµ±æœƒåœ¨ä»¥ä¸‹ä½ç½®è¨˜éŒ„æ—¥èªŒï¼š
- **æœ¬åœ°æª”æ¡ˆ**ï¼š`price_history/` ç›®éŒ„
- **Firebase**ï¼š`system_logs` Collection
- **çµ‚ç«¯è¼¸å‡º**ï¼šåŸ·è¡Œç¨‹å¼æ™‚çš„å³æ™‚æ—¥èªŒ

## ğŸ“ˆ æ•ˆèƒ½å„ªåŒ–

### 1. è³‡æ–™æ¸…ç†

å®šæœŸæ¸…ç†èˆŠçš„åƒ¹æ ¼æ­·å²æª”æ¡ˆï¼š
```bash
# ä¿ç•™æœ€è¿‘30å¤©çš„è³‡æ–™
find price_history/ -name "*.json" -mtime +30 -delete
```

### 2. Firebase æˆæœ¬æ§åˆ¶

- è¨­å®š Firestore è®€å¯«é™åˆ¶
- å®šæœŸæ¸…ç†èˆŠçš„æ—¥èªŒè³‡æ–™
- ä½¿ç”¨ Firebase çš„å…è²»é¡åº¦ç›£æ§

### 3. è¨˜æ†¶é«”å„ªåŒ–

å°æ–¼å¤§é‡è³‡æ–™çš„è™•ç†ï¼Œå¯ä»¥ï¼š
- åˆ†æ‰¹è™•ç†ç”¢å“è³‡æ–™
- ä½¿ç”¨ç”Ÿæˆå™¨æ¸›å°‘è¨˜æ†¶é«”ä½¿ç”¨
- å®šæœŸæ¸…ç†æš«å­˜è³‡æ–™

## ğŸ¯ æœ€ä½³å¯¦è¸

1. **å®šæœŸå‚™ä»½**ï¼šé™¤äº† Firebaseï¼Œä¹Ÿè¦å®šæœŸå‚™ä»½æœ¬åœ°è³‡æ–™
2. **ç›£æ§ç³»çµ±**ï¼šè¨­å®šç³»çµ±ç›£æ§ï¼ŒåŠæ™‚ç™¼ç¾å•é¡Œ
3. **ç”¨æˆ¶é«”é©—**ï¼šå„ªåŒ–é€šçŸ¥å…§å®¹ï¼Œé¿å…éåº¦æ‰“æ“¾ç”¨æˆ¶
4. **è³‡æ–™å“è³ª**ï¼šå®šæœŸæª¢æŸ¥è³‡æ–™æº–ç¢ºæ€§ï¼Œä¿®æ­£ç•°å¸¸å€¼
5. **å®‰å…¨æ€§**ï¼šä¿è­· API é‡‘é‘°å’Œæ•æ„Ÿè³‡æ–™

## ğŸ“ æŠ€è¡“æ”¯æ´

å¦‚æœé‡åˆ°å•é¡Œï¼Œè«‹ï¼š

1. æª¢æŸ¥æœ¬æŒ‡å—çš„æ•…éšœæ’é™¤ç« ç¯€
2. æŸ¥çœ‹ç³»çµ±æ—¥èªŒäº†è§£éŒ¯èª¤è©³æƒ…
3. ç¢ºèªæ‰€æœ‰ä¾è³´å¥—ä»¶å·²æ­£ç¢ºå®‰è£
4. æª¢æŸ¥ç¶²è·¯é€£æ¥å’Œå¤–éƒ¨æœå‹™ç‹€æ…‹

---

**ğŸ‰ æ­å–œï¼ä½ ç¾åœ¨å·²ç¶“æŒæ¡äº†å®Œæ•´çš„ Apple æ•´ä¿®å“åƒ¹æ ¼è¿½è¹¤ç³»çµ±ï¼** 